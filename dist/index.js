(()=>{"use strict";var e={922:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var c=0;c<this.length;c++){var u=this[c][0];null!=u&&(i[u]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&i[l[0]]||(void 0!==a&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=a),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),o&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=o):l[4]="".concat(o)),t.push(l))}},t}},251:e=>{e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),a="/*# ".concat(o," */"),i=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(i).concat([a]).join("\n")}return[t].join("\n")}},424:(e,t,n)=>{n.d(t,{Z:()=>c});var r=n(251),o=n.n(r),a=n(922),i=n.n(a)()(o());i.push([e.id,".box {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  background-size: contain;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-color: rgba(24,144,255,0.5);\n}\n","",{version:3,sources:["webpack://./src/index.css"],names:[],mappings:"AAAA;EACE,WAAW;EACX,YAAY;EACZ,kBAAkB;EAClB,wBAAwB;EACxB,2BAA2B;EAC3B,4BAA4B;EAC5B,sCAAsC;AACxC",sourcesContent:[".box {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  background-size: contain;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-color: rgba(24,144,255,0.5);\n}\n"],sourceRoot:""}]);const c=i},379:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},i=[],c=0;c<e.length;c++){var u=e[c],s=r.base?u[0]+r.base:u[0],l=a[s]||0,f="".concat(s," ").concat(l);a[s]=l+1;var d=n(f),h={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==d)t[d].references++,t[d].updater(h);else{var v=o(h,r);r.byIndex=c,t.splice(c,0,{identifier:f,updater:v,references:1})}i.push(f)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=n(a[i]);t[c].references--}for(var u=r(e,o),s=0;s<a.length;s++){var l=n(a[s]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}a=u}}},569:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r),n.d(r,{default:()=>P});var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)};Object.create,Object.create;const t=require("react");var o,a=n.n(t);!function(e){e[e.out=0]="out",e[e.in=1]="in",e[e.top_left=2]="top_left",e[e.top_right=3]="top_right",e[e.bottom_right=4]="bottom_right",e[e.bottom_left=5]="bottom_left",e[e.top=6]="top",e[e.right=7]="right",e[e.bottom=8]="bottom",e[e.left=9]="left"}(o||(o={}));var i=["default","move","nw-resize","ne-resize","se-resize","sw-resize","n-resize","e-resize","s-resize","w-resize"];function c(e,t,n){return n>e&&n<t}function u(e,t,n){var r=e.x,a=e.y,i=e.width,u=e.height,s=t.offsetX,l=t.offsetY;return c(r+6,r+i-6,s)&&c(a+6,a+u-6,l)?n?Math.pow(s-(r+i/2),2)+Math.pow(l-(a+u/2),2)<Math.pow(u-6,2)?o.in:o.out:o.in:c(r-6,r+6,s)&&c(a-6,a+6,l)?o.top_left:c(r+i-6,r+i+6,s)&&c(a-6,a+6,l)?o.top_right:c(r+i-6,r+i+6,s)&&c(a+u-6,a+u+6,l)?o.bottom_right:c(r-6,r+6,s)&&c(a+u-6,a+u+6,l)?o.bottom_left:c(r+6,r+i-6,s)&&c(a-6,a+6,l)?o.top:c(r+i-6,r+i+6,s)&&c(a+6,a+u-6,l)?o.right:c(r+6,r+i-6,s)&&c(a+u-6,a+u+6,l)?o.bottom:c(r-6,r+6,s)&&c(a+6,a+u-6,l)?o.left:o.out}function s(e,t,n,r,o,a,i,c){var u;return e/t>n/r?[(o-(e-n/(u=r/t))/2)*u,a*u,i*u,c*u]:[o*(u=n/e),(a-(t-r/u)/2)*u,i*u,c*u]}function l(e,t,n,r){e.beginPath(),e.arc(t,n,6,0,2*Math.PI),e.fill(),e.closePath()}function f(e,n,r){var o=function(t){e(t.clientX,t.clientY)},a=function(e){n(e.clientX,e.clientY)},i=function(e){r(e.clientX,e.clientY)},c=function(t){e(t.changedTouches[0].clientX,t.changedTouches[0].clientY)},u=function(e){n(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},s=function(e){r(e.changedTouches[0].clientX,e.changedTouches[0].clientY)};(0,t.useEffect)((function(){return window.addEventListener("mousedown",o),window.addEventListener("mousemove",a),window.addEventListener("mouseup",i),window.addEventListener("touchstart",c),window.addEventListener("touchmove",u),window.addEventListener("touchend",s),function(){window.removeEventListener("mousedown",o),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",i),window.removeEventListener("touchstart",c),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",s)}}),[o,a,i,c,u,s])}const d=function(e){var n=(0,t.useRef)(null),r=e.src,c=e.canvasWidth,d=e.canvasHeight,h=e.square,v=void 0!==h&&h,p=e.circle,g=void 0!==p&&p,m=e.configs,b=m.maskColor,y=m.cropColor,w=(0,t.useState)(function(e,t,n,r){var o=Math.min(200,.4*e),a=Math.min(200,.4*t);return(n||r)&&(a=o=Math.min(o,a)),{x:(e-o)/2,y:(t-a)/2,width:o,height:a}}(c,d,v,g)),x=w[0],k=w[1],T=(0,t.useState)({x:0,y:0}),C=T[0],E=T[1],M=(0,t.useRef)(0),A=(0,t.useRef)(!1);function R(){if(n.current){var t=n.current.getContext("2d");if(t){var o=x.x,a=x.y,i=x.width,u=x.height;t.clearRect(0,0,c,d),t.beginPath(),t.setLineDash([0]),t.lineWidth=.5,t.strokeStyle=y,g?(t.beginPath(),t.lineTo(0,0),t.arc(o+i/2,a+u/2,i/2,0,2*Math.PI),t.lineTo(0,0),t.lineTo(0,d),t.lineTo(c,d),t.lineTo(c,0),t.fillStyle=b,t.fill(),t.beginPath(),t.arc(o+i/2,a+u/2,i/2,0,2*Math.PI),t.stroke()):(t.fillStyle=b,t.fillRect(0,0,c,d),t.clearRect(o,a,i,u),t.rect(o,a,i,u),t.stroke(),t.beginPath(),t.setLineDash([4]),t.strokeStyle="rgba(255,255,255,0.5)",t.moveTo(o+i/3,a),t.lineTo(o+i/3,a+u),t.moveTo(o+i/3,a),t.lineTo(o+i/3,a+u),t.moveTo(o+2*i/3,a),t.lineTo(o+2*i/3,a+u),t.moveTo(o,a+u/3),t.lineTo(o+i,a+u/3),t.moveTo(o,a+2*u/3),t.lineTo(o+i,a+2*u/3),t.stroke()),t.closePath(),t.fillStyle=y,g?l(t,o+i,a+u/2):(v||(l(t,o,a),l(t,o+i,a),l(t,o,a+u),l(t,o+i/2,a),l(t,o,a+u/2),l(t,o+i/2,a+u),l(t,o+i,a+u/2)),l(t,o+i,a+u)),t.closePath();var f=document.createElement("canvas");f.width=i,f.height=u;var h=f.getContext("2d"),p=new Image;p.setAttribute("crossOrigin","anonymous"),p.src=r||"",p.onload=function(){g&&(null==h||h.beginPath(),null==h||h.arc(i/2,i/2,i/2,0,2*Math.PI),null==h||h.clip());var t=s(c,d,p.width,p.height,o,a,i,u);null==h||h.drawImage(p,t[0],t[1],t[2],t[3],0,0,i,u),e.onResult(null==f?void 0:f.toDataURL("image/png",1))}}}}var P=function(e){if(n.current){var t,r=n.current;t=v?e===o.in||e===o.bottom_right?i[e]:"default":g?e===o.in||e===o.right?i[e]:"default":i[e],r.style.cursor=t}},_=(0,t.useCallback)((function(e,t){if(n.current){var r=n.current.getClientRects(),a=e-r[0].x,i=t-r[0].y;if(!A.current){var s=u(x,{offsetX:a,offsetY:i},g);P(s)}if(M.current!==o.out){var l=function(e,t,n,r,a,i,c,u){var s=t.offsetX,l=t.offsetY,f=e.x,d=e.y,h=e.width,v=e.height,p=s-n.x,g=l-n.y,m=f+h,b=d+v;switch(r){case o.in:f+=p,d+=g;break;case o.top_left:if(c||u)break;(h=m-(f=s<0?0:s))<30&&(f=m-(h=30)),(v=b-(d=l<0?0:l))<30&&(d=b-(v=30));break;case o.top_right:if(c||u)break;(v-=g)<30&&(d=b-(v=30)),(d=b-v)<0&&(v=b-(d=0)),f+(h+=p)>a&&(h=a-f);break;case o.bottom_right:c&&(Math.abs(p)<Math.abs(g)?g=p:p=g),(h+=p)<30&&(h=30),(v+=g)<30&&(v=30),f+h>a&&(h=a-f),d+v>i&&(v=i-d);break;case o.bottom_left:if(c||u)break;(h=m-(f=s<0?0:s))<30&&(f=m-(h=30)),(v+=g)<30&&(d=b-(v=30)),d+v>i&&(v=i-d);break;case o.top:if(c||u)break;(v=b-(d=l<0?0:l))<30&&(d=b-(v=30));break;case o.bottom:if(c||u)break;(v+=g)<30&&(v=30),d+v>i&&(v=i-d);break;case o.right:if(c)break;if((h+=p)<30&&(h=30),f+h>a&&(h=a-f),u){var y=d+v/2;y+h/2>i?h=v=2*(i-y):y-h/2<0?h=v=2*y:v=h,d=y-v/2}break;case o.left:if(c||u)break;(h=m-(f=s<0?0:s))<30&&(f=m-(h=30))}return f<0&&(f=0),d<0&&(d=0),f+h>a&&(f=a-h),d+v>i&&(d=i-v),{x:f,y:d,width:h,height:v}}(x,{offsetX:a,offsetY:i},C,M.current,c,d,v,g),f=l.x,h=l.y,p=l.width,m=l.height;E({x:a,y:i}),k({x:f,y:h,width:p,height:m}),R()}}}),[C,x]),S=(0,t.useCallback)((function(e,t){A.current=!1,M.current=0}),[]);return(0,t.useEffect)((function(){R()}),[]),f((function(e,t){if(n.current){var r=n.current.getClientRects(),o=e-r[0].x,a=t-r[0].y;A.current=!0,M.current=u(x,{offsetX:o,offsetY:a},g),P(M.current),E({x:o,y:a})}}),_,S),a().createElement("canvas",{ref:n,width:c,height:d})},h=function(e){var n=(0,t.useRef)(null),r=e.src,o=e.canvasWidth,i=e.canvasHeight,c=e.dots,u=void 0===c?4:c,d=e.configs,h=d.cropColor,v=d.maskColor,p=(0,t.useState)(function(e,t,n){for(var r=Math.min(.5*e,.5*t,200)/2,o=e/2,a=t/2,i=[],c=0;c<n;c++){var u;u=n%2==1?c/n*2*Math.PI-Math.PI/2:(c+.5)/n*2*Math.PI;var s=Math.cos(u).toFixed(3),l=Math.sin(u).toFixed(3);i.push({x:o+r*parseFloat(s),y:a+r*parseFloat(l)})}return i}(o,i,u)),g=p[0],m=p[1],b=(0,t.useRef)(u),y=(0,t.useRef)(!1);function w(){if(n.current){var t=n.current.getContext("2d");if(t){t.clearRect(0,0,o,i),t.fillStyle=v,t.beginPath(),t.lineTo(0,0);for(var a=0;a<u;a++)t.lineTo(g[a].x,g[a].y);for(t.lineTo(g[0].x,g[0].y),t.lineTo(0,0),t.lineTo(0,i),t.lineTo(o,i),t.lineTo(o,0),t.fill(),t.strokeStyle=h,t.fillStyle=h,t.beginPath(),t.setLineDash([4]),a=0;a<u;a++)t.lineTo(g[a].x,g[a].y);for(t.lineTo(g[0].x,g[0].y),a=0;a<u;a++)l(t,g[a].x,g[a].y);t.stroke(),t.closePath();var c=document.createElement("canvas"),f=0,d=o,p=0,m=i;g.forEach((function(e){f=Math.max(f,e.x),d=Math.min(d,e.x),p=Math.max(p,e.y),m=Math.min(m,e.y)})),c.width=f-d,c.height=p-m;var b=c.getContext("2d"),y=new Image;y.setAttribute("crossOrigin","anonymous"),y.src=r||"",y.onload=function(){null==b||b.beginPath(),g.forEach((function(e){null==b||b.lineTo(e.x-d,e.y-m)})),null==b||b.lineTo(g[0].x-d,g[0].y-m),null==b||b.clip();var t=s(o,i,y.width,y.height,d,m,c.width,c.height);null==b||b.drawImage(y,t[0],t[1],t[2],t[3],0,0,c.width,c.height),e.onResult(null==c?void 0:c.toDataURL("image/png",1))}}}}(0,t.useEffect)((function(){w()}),[]);var x=function(e){n.current&&(n.current.style.cursor=e===u?"default":"move")};function k(e,t,n){return n>e&&n<t}function T(e,t){for(var n=0;n<u;n++)if(k(e[n].x-6,e[n].x+6,t.x)&&k(e[n].y-6,e[n].y+6,t.y))return n;return u}return f((function(e,t){if(n.current){var r=n.current.getClientRects(),o=e-r[0].x,a=t-r[0].y;b.current=T(g,{x:o,y:a}),x(b.current)}}),(function(e,t){if(n.current){var r=n.current.getClientRects(),a=e-r[0].x,c=t-r[0].y;if(!y.current){var s=T(g,{x:a,y:c});x(s)}b.current!==u&&(a<0&&(a=0),c<0&&(c=0),a>o&&(a=o),c>i&&(c=i),g[b.current]={x:a,y:c},m(g),w())}}),(function(e,t){y.current=!1,b.current=u})),a().createElement("canvas",{ref:n,width:o,height:i})};var v=n(379),p=n.n(v),g=n(795),m=n.n(g),b=n(569),y=n.n(b),w=n(565),x=n.n(w),k=n(216),T=n.n(k),C=n(589),E=n.n(C),M=n(424),A={};A.styleTagTransform=E(),A.setAttributes=x(),A.insert=y().bind(null,"head"),A.domAPI=m(),A.insertStyleElement=T(),p()(M.Z,A),M.Z&&M.Z.locals&&M.Z.locals;var R={backgroundColor:"rgba(24,144,255,0.5)",maskColor:"rgba(0,0,0,0.6)",cropColor:"rgba(24,144,255,1)"};const P=function(n){var r=n.type,o=void 0===r?"rectangle":r,i=n.image,c=void 0===i?"":i,u=n.configs,s=(0,t.useRef)(null),l=(null==u?void 0:u.backgroundColor)||R.backgroundColor,f=(0,t.useMemo)((function(){if(!s.current)return null;var t=s.current,r={canvasWidth:t.clientWidth,canvasHeight:t.clientHeight,src:c,configs:e(e({},R),u)};switch(o){case"rectangle":return a().createElement(d,e({onResult:n.onResult},r));case"square":return a().createElement(d,e({onResult:n.onResult},r,{square:!0}));case"circle":return a().createElement(d,e({onResult:n.onResult},r,{circle:!0}));case"polygon":return a().createElement(h,e({onResult:n.onResult,dots:n.nodesNum||4},r));default:throw new Error("wrong type,the type could only be circle,square,rectangle or polygon")}}),[o,c,s.current]);return a().createElement("div",{ref:s,className:"box",style:e(e({},n.style),{backgroundImage:"url(".concat(c,")"),backgroundColor:l})},f)}})();var o=exports;for(var a in r)o[a]=r[a];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=index.js.map